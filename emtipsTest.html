// Display leaderboard
const leaderboardSheet = workbook.Sheets["PoÃ¤ng_matcher"];
const playerNames = XLSX.utils.sheet_to_json(leaderboardSheet, { header: 1 })[0].slice(2);
const totalPoints = XLSX.utils.sheet_to_json(leaderboardSheet, { range: 62, header: 1 })[0].slice(2);
const leaderboardBody = document.getElementById("leaderboard-body");
const leaderboardData = [];
playerNames.forEach((name, index) => {
    leaderboardData.push({ name: name, points: totalPoints[index] });
});

// Sort leaderboard in descending order
leaderboardData.sort((a, b) => b.points - a.points);

// Assign ranks, ensuring same rank for tied points
let currentRank = 1;
for (let i = 0; i < leaderboardData.length; i++) {
    if (i > 0 && leaderboardData[i].points === leaderboardData[i - 1].points) {
        leaderboardData[i].rank = leaderboardData[i - 1].rank;
    } else {
        leaderboardData[i].rank = currentRank;
    }
    currentRank++;
}

// Calculate distribution
const prizePool = 3600;
const distributions = [0.55, 0.20, 0.12, 0.08, 0.05];
let payouts = Array(playerNames.length).fill(0);

let rank = 1;
for (let i = 0; i < leaderboardData.length; i++) {
    let samePointsGroup = [leaderboardData[i]];
    while (i + 1 < leaderboardData.length && leaderboardData[i].points === leaderboardData[i + 1].points) {
        samePointsGroup.push(leaderboardData[++i]);
    }

    let totalDistribution = 0;
    for (let j = 0; j < samePointsGroup.length; j++) {
        if (rank + j - 1 < distributions.length) {
            totalDistribution += distributions[rank + j - 1];
        }
    }
    let averageDistribution = totalDistribution / samePointsGroup.length;

    samePointsGroup.forEach(player => {
        if (rank - 1 < distributions.length) {
            player.payout = prizePool * averageDistribution;
            player.percentage = (averageDistribution * 100).toFixed(2) + '%';
        } else {
            player.payout = 0;
            player.percentage = '';
        }
    });

    rank += samePointsGroup.length;
}

leaderboardData.forEach(player => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${player.rank}</td><td>${player.name}</td><td>${player.points}</td><td>${player.payout ? player.payout.toFixed(2) + ' kr (' + player.percentage + ')' : ''}</td>`;
    leaderboardBody.appendChild(tr);
});

// Display game results
const gameResultsSheet = workbook.Sheets["Resultat"];
const gameResultsBody = document.getElementById("game-results-body");
for (let i = 6; i <= 65; i++) {
    const homeTeamCell = gameResultsSheet[XLSX.utils.encode_cell({ r: i, c: 4 })];
    const awayTeamCell = gameResultsSheet[XLSX.utils.encode_cell({ r: i, c: 6 })];
    const goalsHomeCell = gameResultsSheet[XLSX.utils.encode_cell({ r: i, c: 8 })];
    const goalsAwayCell = gameResultsSheet[XLSX.utils.encode_cell({ r: i, c: 10 })];

    if (homeTeamCell && awayTeamCell && goalsHomeCell && goalsAwayCell) {
        const homeTeam = homeTeamCell.v;
        const awayTeam = awayTeamCell.v;
        const goalsHome = goalsHomeCell.v;
        const goalsAway = goalsAwayCell.v;

        let resultSign;
        if (goalsHome > goalsAway) {
            resultSign = "1";
        } else if (goalsHome < goalsAway) {
            resultSign = "2";
        } else {
            resultSign = "X";
        }

        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${homeTeam} vs ${awayTeam}</td><td>${resultSign} (${goalsHome} - ${goalsAway})</td>`;
        gameResultsBody.appendChild(tr);
    }
}

})
.catch(error => console.error('Error fetching or processing Excel file:', error));

});
</script>
</body>
</html>
